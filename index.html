<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Search Hub - Pro</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for Data Analysis -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Font Awesome (Webfont version, NO SVG) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap');
        
        :root {
            --yt-main: #0f0f0f;
            --yt-surface: #272727;
            --yt-border: #3f3f3f;
        }

        body {
            background-color: var(--yt-main);
            color: #ffffff;
            font-family: 'Assistant', sans-serif;
            margin: 0;
            overflow-x: hidden;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: var(--yt-main); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--yt-border); border-radius: 10px; }

        .video-card img {
            transition: transform 0.3s ease;
        }
        .video-card:hover img {
            transform: scale(1.02);
            border-radius: 4px;
        }

        #videoModal {
            display: none;
            backdrop-filter: blur(8px);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="custom-scrollbar">

    <!-- Chosen Palette: YouTube Dark Minimalist (Neutrals & Red Accent) -->
    <!-- Application Structure Plan: 
         1. Header: Global search and identity.
         2. Sidebar: Navigation and static insights.
         3. Dashboard: Main search results grid with mixed content (Video/Channel).
         4. Analytics: A dynamic section showing stats about the search results using Chart.js.
         5. Modals: Floating player for focused consumption.
         Chosen for high usability, mirroring familiar UX patterns while adding data-driven insights. -->

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 h-16 bg-[#0f0f0f]/95 border-b border-[#222] flex items-center justify-between px-6 z-[100]">
        <div class="flex items-center gap-5">
            <button class="text-xl p-2 hover:bg-[#272727] rounded-full transition"><i class="fas fa-bars"></i></button>
            <div class="flex items-center gap-1 cursor-pointer">
                <i class="fab fa-youtube text-[#ff0000] text-3xl"></i>
                <span class="text-xl font-bold tracking-tight">YouTube <span class="text-xs font-normal text-gray-500 mr-1">IL</span></span>
            </div>
        </div>

        <div class="flex-1 max-w-2xl flex items-center px-4">
            <div class="flex w-full group">
                <input type="text" id="searchInput" placeholder="חיפוש" 
                    class="w-full bg-[#121212] border border-[#303030] rounded-r-full py-2.5 px-5 focus:border-blue-500 outline-none transition">
                <button onclick="performSearch(false)" 
                    class="bg-[#222222] border border-[#303030] border-r-0 rounded-l-full px-6 hover:bg-[#2a2a2a] transition">
                    <i class="fas fa-search text-gray-300"></i>
                </button>
            </div>
        </div>

        <div class="flex items-center gap-4">
            <div id="authContainer">
                <div id="g_id_signin"></div>
            </div>
            <div id="userDisplay" class="hidden flex items-center gap-3">
                <img id="userImg" class="w-8 h-8 rounded-full border border-gray-600">
            </div>
        </div>
    </header>

    <div class="flex pt-16 min-h-screen">
        <!-- Sidebar -->
        <aside class="w-64 fixed right-0 top-16 bottom-0 hidden lg:block bg-[#0f0f0f] border-l border-[#222] p-4 overflow-y-auto custom-scrollbar">
            <nav class="space-y-2">
                <div class="flex items-center gap-5 p-3 hover:bg-[#272727] rounded-xl cursor-pointer bg-[#272727]">
                    <i class="fas fa-house text-lg"></i><span class="font-medium">דף הבית</span>
                </div>
                <div class="flex items-center gap-5 p-3 hover:bg-[#272727] rounded-xl cursor-pointer">
                    <i class="fas fa-bolt text-lg"></i><span>Shorts</span>
                </div>
                <div class="flex items-center gap-5 p-3 hover:bg-[#272727] rounded-xl cursor-pointer">
                    <i class="fas fa-layer-group text-lg"></i><span>מנויים</span>
                </div>
            </nav>
            
            <div class="mt-8">
                <h4 class="px-3 text-sm font-bold text-gray-400 mb-4 uppercase tracking-wider">ניתוח תוצאות</h4>
                <div class="chart-container p-2">
                    <canvas id="statsChart"></canvas>
                </div>
                <p class="text-[10px] text-gray-500 px-3 mt-2">התרשים מציג התפלגות לייקים בתוצאות האחרונות.</p>
            </div>
        </aside>

        <!-- Main Dashboard -->
        <main class="flex-1 lg:mr-64 p-6">
            <!-- Introduction -->
            <section class="mb-10 max-w-4xl">
                <h1 class="text-3xl font-bold mb-3">ברוכים הבאים ל-Search Hub</h1>
                <p class="text-gray-400 leading-relaxed">
                    כלי זה מאפשר לך לחקור את יוטיוב בצורה עמוקה יותר. חפש סרטונים וערוצים, קבל נתונים סטטיסטיים בזמן אמת על הפופולריות של התוכן, ונהל את החיפושים שלך בממשק אחד נקי ומהיר.
                </p>
            </section>

            <!-- Grid -->
            <div id="resultsGrid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6">
                <!-- Initial Welcome -->
                <div class="col-span-full flex flex-col items-center justify-center py-20 opacity-20">
                    <i class="fab fa-youtube text-[120px] mb-6"></i>
                    <h3 class="text-2xl font-bold">הזן חיפוש למעלה כדי להתחיל</h3>
                </div>
            </div>

            <!-- Load More -->
            <div id="pagination" class="hidden mt-12 mb-20 flex justify-center">
                <button onclick="performSearch(true)" 
                    class="bg-white text-black px-12 py-3 rounded-full font-bold hover:bg-gray-200 transition-all transform active:scale-95 shadow-lg">
                    טען תוצאות נוספות
                </button>
            </div>
        </main>
    </div>

    <!-- Floating Video Player Modal -->
    <div id="videoModal" class="fixed inset-0 z-[200] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90" onclick="closePlayer()"></div>
        <div class="relative bg-[#0f0f0f] w-full max-w-5xl max-h-[90vh] rounded-3xl overflow-hidden flex flex-col border border-[#333] shadow-2xl">
            <div class="p-4 flex justify-between items-center border-b border-[#222]">
                <h3 id="modalTitle" class="font-bold text-lg truncate px-2"></h3>
                <button onclick="closePlayer()" class="w-10 h-10 hover:bg-[#272727] rounded-full transition flex items-center justify-center">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto custom-scrollbar">
                <div class="aspect-video w-full">
                    <iframe id="playerFrame" class="w-full h-full" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
                </div>
                <div class="p-8">
                    <div class="flex flex-wrap justify-between items-start gap-4 mb-6">
                        <div>
                            <h2 id="fullTitle" class="text-2xl font-bold mb-4"></h2>
                            <div class="flex items-center gap-4">
                                <div id="modalChannelImg" class="w-12 h-12 rounded-full bg-gray-700 overflow-hidden"></div>
                                <div>
                                    <p id="modalChannelName" class="font-bold text-lg"></p>
                                    <p class="text-xs text-gray-500">ערוץ מאומת</p>
                                </div>
                                <button class="mr-6 bg-red-600 px-5 py-2 rounded-full font-bold text-sm hover:bg-red-700 transition">הירשם</button>
                            </div>
                        </div>
                    </div>
                    <div class="bg-[#222] p-5 rounded-2xl">
                        <p id="modalStats" class="text-sm font-bold mb-3 text-gray-300"></p>
                        <div id="modalDesc" class="text-sm text-gray-400 whitespace-pre-wrap leading-relaxed"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Setup Modal -->
    <div id="configModal" class="fixed inset-0 z-[300] bg-black/95 flex items-center justify-center p-4">
        <div class="bg-[#1a1a1a] p-8 rounded-3xl w-full max-w-md border border-[#333] shadow-2xl">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4 rotate-3">
                    <i class="fas fa-cog text-3xl"></i>
                </div>
                <h2 class="text-2xl font-bold">הגדרות מערכת</h2>
                <p class="text-gray-500 text-sm mt-1">אנא הזן את פרטי ה-API שלך</p>
            </div>
            <div class="space-y-5">
                <div>
                    <label class="block text-xs font-bold text-gray-400 mb-2 uppercase">YouTube Data API Key</label>
                    <input type="password" id="apiKeyInput" class="w-full bg-[#0f0f0f] border border-[#333] rounded-xl py-3 px-4 focus:border-red-600 outline-none transition">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400 mb-2 uppercase">Google Client ID (אופציונלי)</label>
                    <input type="text" id="clientIdInput" placeholder="למשל: xxxx.apps.googleusercontent.com" class="w-full bg-[#0f0f0f] border border-[#333] rounded-xl py-3 px-4 focus:border-blue-600 outline-none transition">
                </div>
                <button onclick="saveAndStart()" class="w-full bg-white text-black py-4 rounded-xl font-bold hover:bg-gray-200 transition shadow-lg mt-4">
                    שמור והתחל לעבוד
                </button>
            </div>
        </div>
    </div>

    <!-- Visualization & Content Choices:
         1. Video/Channel Data -> Compare -> Bar Chart (Chart.js) -> Distribution of likes among results -> To help user find high-engagement content.
         2. Search Results -> Organize -> Custom Responsive Grid -> Mixed Card Layout -> For visual clarity.
         3. Metadata -> Inform -> HTML Content Blocks -> Detailed views in Modal -> Deep dive without losing context.
    -->

    <script>
        // State Management
        let appState = {
            apiKey: "",
            clientId: "",
            pageToken: "",
            query: "",
            results: [],
            chart: null,
            channelCache: {}
        };

        // Initialization
        function saveAndStart() {
            appState.apiKey = document.getElementById('apiKeyInput').value.trim();
            appState.clientId = document.getElementById('clientIdInput').value.trim();
            
            if (!appState.apiKey) {
                alert("חובה להזין מפתח API");
                return;
            }

            document.getElementById('configModal').style.display = 'none';
            if (appState.clientId) initAuth();
            initChart();
        }

        function initAuth() {
            google.accounts.id.initialize({
                client_id: appState.clientId,
                callback: handleAuth
            });
            google.accounts.id.renderButton(
                document.getElementById("g_id_signin"),
                { theme: "dark", size: "large", shape: "pill" }
            );
        }

        function handleAuth(response) {
            const data = JSON.parse(atob(response.credential.split('.')[1]));
            document.getElementById('authContainer').classList.add('hidden');
            const display = document.getElementById('userDisplay');
            display.classList.remove('hidden');
            document.getElementById('userImg').src = data.picture;
        }

        function initChart() {
            const ctx = document.getElementById('statsChart').getContext('2d');
            appState.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'לייקים',
                        data: [],
                        backgroundColor: '#ff0000',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { display: false },
                        x: { ticks: { color: '#666', font: { size: 8 } } }
                    }
                }
            });
        }

        async function performSearch(loadMore) {
            const query = document.getElementById('searchInput').value;
            if (!query) return;

            if (!loadMore) {
                appState.query = query;
                appState.pageToken = "";
                document.getElementById('resultsGrid').innerHTML = '<div class="col-span-full text-center py-20">טוען...</div>';
            }

            try {
                let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=12&q=${encodeURIComponent(appState.query)}&type=video,channel&key=${appState.apiKey}`;
                if (appState.pageToken) url += `&pageToken=${appState.pageToken}`;

                const res = await fetch(url);
                const data = await res.json();
                if (data.error) throw new Error(data.error.message);

                appState.pageToken = data.nextPageToken || "";
                document.getElementById('pagination').classList.toggle('hidden', !appState.pageToken);

                const videoIds = data.items.filter(i => i.id.kind === 'youtube#video').map(i => i.id.videoId);
                const channelIds = [...new Set(data.items.map(i => i.snippet.channelId))];

                const [statsRes, channelsRes] = await Promise.all([
                    videoIds.length ? fetch(`https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${videoIds.join(',')}&key=${appState.apiKey}`).then(r => r.json()) : {items: []},
                    fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet&id=${channelIds.join(',')}&key=${appState.apiKey}`).then(r => r.json())
                ]);

                const statsMap = Object.fromEntries(statsRes.items.map(i => [i.id, i.statistics]));
                channelsRes.items.forEach(c => appState.channelCache[c.id] = c.snippet.thumbnails.default.url);

                renderResults(data.items, statsMap, !loadMore);
                updateChart(statsRes.items);

            } catch (err) {
                console.error(err);
                alert("שגיאה בחיפוש: " + err.message);
            }
        }

        function renderResults(items, statsMap, clear) {
            const grid = document.getElementById('resultsGrid');
            if (clear) grid.innerHTML = '';

            items.forEach(item => {
                const snip = item.snippet;
                const isVideo = item.id.kind === 'youtube#video';
                const card = document.createElement('div');

                if (!isVideo) {
                    card.className = "col-span-full bg-[#1a1a1a] rounded-3xl p-6 flex flex-col sm:flex-row items-center gap-8 border border-[#222] hover:border-[#444] transition cursor-pointer mb-4";
                    card.onclick = () => window.open(`https://www.youtube.com/channel/${item.id.channelId}`, '_blank');
                    card.innerHTML = `
                        <img src="${snip.thumbnails.high.url}" class="w-32 h-32 rounded-full shadow-2xl border-4 border-[#333]">
                        <div class="text-center sm:text-right">
                            <h3 class="text-2xl font-bold mb-2">${snip.title}</h3>
                            <p class="text-gray-500 text-sm mb-4">@${snip.channelTitle} • ערוץ תוכן</p>
                            <button class="bg-white text-black px-8 py-2 rounded-full font-bold text-sm">מעקב</button>
                        </div>
                    `;
                } else {
                    const id = item.id.videoId;
                    const stats = statsMap[id] || {viewCount: 0, likeCount: 0};
                    const avatar = appState.channelCache[snip.channelId] || '';
                    
                    card.className = "video-card group flex flex-col cursor-pointer";
                    card.innerHTML = `
                        <div class="relative mb-4" onclick="openPlayer('${id}', '${snip.title.replace(/'/g, "\\'")}')">
                            <img src="${snip.thumbnails.high.url}" class="w-full aspect-video object-cover rounded-2xl bg-[#222]">
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-all">
                                <i class="fas fa-play text-3xl"></i>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <img src="${avatar}" class="w-10 h-10 rounded-full border border-[#333] flex-shrink-0">
                            <div class="flex-1 min-w-0">
                                <h3 class="font-bold text-sm line-clamp-2 mb-1" onclick="openPlayer('${id}', '${snip.title.replace(/'/g, "\\'")}')">${snip.title}</h3>
                                <p class="text-gray-500 text-xs hover:text-white transition">${snip.channelTitle}</p>
                                <p class="text-gray-500 text-xs mt-1 font-medium">${formatNum(stats.viewCount)} צפיות • ${formatNum(stats.likeCount)} לייקים</p>
                            </div>
                        </div>
                    `;
                }
                grid.appendChild(card);
            });
        }

        function updateChart(videoItems) {
            if (!appState.chart) return;
            const labels = videoItems.slice(0, 6).map(v => v.snippet.title.substring(0, 10) + '...');
            const data = videoItems.slice(0, 6).map(v => parseInt(v.statistics.likeCount || 0));
            
            appState.chart.data.labels = labels;
            appState.chart.data.datasets[0].data = data;
            appState.chart.update();
        }

        function formatNum(n) {
            n = parseInt(n);
            if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
            if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
            return n;
        }

        async function openPlayer(id, title) {
            const modal = document.getElementById('videoModal');
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('fullTitle').innerText = title;
            document.getElementById('playerFrame').src = `https://www.youtube.com/embed/${id}?autoplay=1`;
            
            const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${id}&key=${appState.apiKey}`);
            const data = await res.json();
            const item = data.items[0];
            
            document.getElementById('modalDesc').innerText = item.snippet.description;
            document.getElementById('modalChannelName').innerText = item.snippet.channelTitle;
            document.getElementById('modalStats').innerText = `${parseInt(item.statistics.viewCount).toLocaleString()} צפיות • ${new Date(item.snippet.publishedAt).toLocaleDateString('he-IL')}`;
            document.getElementById('modalChannelImg').innerHTML = `<img src="${appState.channelCache[item.snippet.channelId]}" class="w-full h-full object-cover">`;

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closePlayer() {
            document.getElementById('videoModal').style.display = 'none';
            document.getElementById('playerFrame').src = '';
            document.body.style.overflow = 'auto';
        }

        document.getElementById('searchInput').addEventListener('keypress', e => { if (e.key === 'Enter') performSearch(false); });

        // CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    </script>
</body>
</html>